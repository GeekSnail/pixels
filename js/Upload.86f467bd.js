(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Upload"],{"9bd5":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{"text-xs-center":""}},[a("v-layout",{attrs:{row:"",wrap:"","mb-3":""}},[a("v-flex",{attrs:{xs12:"",sm6:"","offset-sm3":""}},[a("h1",{staticClass:"primary--text"},[t._v("上传照片")])])],1),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:"",sm6:"","offset-sm3":""}},[a("v-form",{ref:"form",attrs:{"lazy-validation":""},on:{submit:function(e){return e.preventDefault(),t.addPost(e)}},model:{value:t.isFormValid,callback:function(e){t.isFormValid=e},expression:"isFormValid"}},[a("v-layout",{attrs:{row:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-text-field",{attrs:{solo:"",rules:t.imageRules,label:"上传照片","prepend-inner-icon":"mdi-cloud-upload-outline",required:"",readonly:""},on:{click:t.pickFile},model:{value:t.imageName,callback:function(e){t.imageName=e},expression:"imageName"}}),a("input",{ref:"image",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.onFilePicked}})],1)],1),t.imageUrl?a("v-layout",{attrs:{row:""}},[a("v-flex",{attrs:{xs12:""}},[a("img",{ref:"preview",attrs:{src:t.imageUrl,height:"300px",alt:""}})])],1):t._e(),[a("v-combobox",{attrs:{items:t.tagsSearchList,label:"标签",tags:"",clearable:"","prepend-inner-icon":"mdi-tag-text-outline",solo:"",multiple:""},scopedSlots:t._u([{key:"selection",fn:function(e){return[a("v-chip",{attrs:{selected:e.selected,close:""},on:{input:function(a){return t.remove(e.item)}}},[a("strong",[t._v(t._s(e.item))]),t._v(" \n                ")])]}}]),model:{value:t.post.tags,callback:function(e){t.$set(t.post,"tags",e)},expression:"post.tags"}})],a("v-layout",{attrs:{row:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-textarea",{attrs:{solo:"",rules:t.descRules,label:"描述",type:"text",required:""},model:{value:t.post.description,callback:function(e){t.$set(t.post,"description",e)},expression:"post.description"}})],1)],1),a("v-layout",{attrs:{row:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-btn",{attrs:{loading:t.loading,disabled:!t.isFormValid||t.loading,block:"",color:"info",type:"submit"},scopedSlots:t._u([{key:"loader",fn:function(){return[a("span",{staticClass:"custom-loader"},[a("v-icon",{attrs:{light:""}},[t._v("mdi-cached")])],1)]},proxy:!0}])},[t._v("\n              发 布\n            ")])],1)],1)],2)],1)],1)],1)},s=[],o=a("75fc"),r=(a("7f7f"),a("cebc")),l=(a("39ff"),a("2f62")),n={name:"Upload",data:function(){return{isFormValid:!0,post:{naturalWidth:0,naturalHeight:0,tags:[],description:""},imageName:"",imageUrl:"",imageFile:"",tagsSearchList:["art","Education","Travel","Photography","Technology"],imageRules:[function(t){return!!t||"照片不得为空"}],descRules:[function(t){return!!t||"描述不得为空"},function(t){return t.length<=150||"描述至多150个字符"}]}},computed:Object(r["a"])({},Object(l["b"])(["loading","user"])),methods:{pickFile:function(){this.$refs.image.click()},onFilePicked:function(t){var e=this,a=t.target.files;if(void 0!==a[0]){if(this.imageName=a[0].name,this.imageName.lastIndexOf(".")<=0)return;var i=new FileReader;i.readAsDataURL(a[0]),i.addEventListener("load",function(){e.imageUrl=i.result,e.imageFile=a[0],e.$nextTick(function(){var t=e;e.$refs.preview.onload=function(){console.log(this.naturalWidth,this.naturalHeight),t.post.naturalWidth=this.naturalWidth,t.post.naturalHeight=this.naturalHeight}})})}else this.imageName="",this.imageFile="",this.imageUrl=""},remove:function(t){this.tags.splice(this.tags.indexOf(t),1),this.tags=Object(o["a"])(this.tags)},addPost:function(){this.$refs.form.validate()&&(this.$store.dispatch("addPost",{payload:Object(r["a"])({},this.post,{userId:this.user._id,image:this.imageFile}),imageUrl:this.imageUrl}),console.log("/upload -> /"),this.$router.push("/"))}}},c=n,u=a("2877"),d=a("6544"),m=a.n(d),p=a("8336"),f=a("cc20"),g=a("2b5d"),h=a("a523"),v=a("0e8f"),x=a("4bd4"),b=a("132d"),y=a("a722"),w=a("2677"),F=a("a844"),k=Object(u["a"])(c,i,s,!1,null,null,null);e["default"]=k.exports;m()(k,{VBtn:p["a"],VChip:f["a"],VCombobox:g["a"],VContainer:h["a"],VFlex:v["a"],VForm:x["a"],VIcon:b["a"],VLayout:y["a"],VTextField:w["a"],VTextarea:F["a"]})}}]);