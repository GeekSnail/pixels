(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Post"],{"11e9":function(t,e,i){var s=i("52a7"),o=i("4630"),a=i("6821"),n=i("6a99"),r=i("69a8"),c=i("c69a"),l=Object.getOwnPropertyDescriptor;e.f=i("9e1e")?l:function(t,e){if(t=a(t),e=n(e,!0),c)try{return l(t,e)}catch(i){}if(r(t,e))return o(!s.f.call(t,e),t[e])}},"169a":function(t,e,i){"use strict";i("6ec0");var s=i("c69d"),o=i("30d4"),a=i("14ec"),n=i("e949"),r=i("261e"),c=i("98a1"),l=i("c584"),d=i("80d2"),u=i("bfc5"),h=i("d9bd"),v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t};function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}e["a"]={name:"v-dialog",directives:{ClickOutside:l["a"]},mixins:[s["a"],o["a"],a["a"],n["a"],r["a"],c["a"]],props:{disabled:Boolean,persistent:Boolean,fullscreen:Boolean,fullWidth:Boolean,noClickAnimation:Boolean,light:Boolean,dark:Boolean,maxWidth:{type:[String,Number],default:"none"},origin:{type:String,default:"center center"},width:{type:[String,Number],default:"auto"},scrollable:Boolean,transition:{type:[String,Boolean],default:"dialog-transition"}},data:function(){return{animate:!1,animateTimeout:null,stackClass:"v-dialog__content--active",stackMinZIndex:200}},computed:{classes:function(){var t;return t={},f(t,("v-dialog "+this.contentClass).trim(),!0),f(t,"v-dialog--active",this.isActive),f(t,"v-dialog--persistent",this.persistent),f(t,"v-dialog--fullscreen",this.fullscreen),f(t,"v-dialog--scrollable",this.scrollable),f(t,"v-dialog--animated",this.animate),t},contentClasses:function(){return{"v-dialog__content":!0,"v-dialog__content--active":this.isActive}},hasActivator:function(){return Boolean(!!this.$slots.activator||!!this.$scopedSlots.activator)}},watch:{isActive:function(t){t?(this.show(),this.hideScroll()):(this.removeOverlay(),this.unbind())},fullscreen:function(t){this.isActive&&(t?(this.hideScroll(),this.removeOverlay(!1)):(this.showScroll(),this.genOverlay()))}},beforeMount:function(){var t=this;this.$nextTick(function(){t.isBooted=t.isActive,t.isActive&&t.show()})},mounted:function(){"v-slot"===Object(d["k"])(this,"activator",!0)&&Object(h["a"])("v-dialog's activator slot must be bound, try '<template #activator=\"data\"><v-btn v-on=\"data.on>'",this)},beforeDestroy:function(){"undefined"!==typeof window&&this.unbind()},methods:{animateClick:function(){var t=this;this.animate=!1,this.$nextTick(function(){t.animate=!0,clearTimeout(t.animateTimeout),t.animateTimeout=setTimeout(function(){return t.animate=!1},150)})},closeConditional:function(t){return!(!this.isActive||this.$refs.content.contains(t.target))&&(this.persistent?(this.noClickAnimation||this.overlay!==t.target||this.animateClick(),!1):this.activeZIndex>=this.getMaxZIndex())},hideScroll:function(){this.fullscreen?document.documentElement.classList.add("overflow-y-hidden"):a["a"].options.methods.hideScroll.call(this)},show:function(){!this.fullscreen&&!this.hideOverlay&&this.genOverlay(),this.$refs.content.focus(),this.bind()},bind:function(){window.addEventListener("focusin",this.onFocusin)},unbind:function(){window.removeEventListener("focusin",this.onFocusin)},onKeydown:function(t){if(t.keyCode===d["n"].esc&&!this.getOpenDependents().length)if(this.persistent)this.noClickAnimation||this.animateClick();else{this.isActive=!1;var e=this.getActivator();this.$nextTick(function(){return e&&e.focus()})}this.$emit("keydown",t)},onFocusin:function(t){var e=event,i=e.target;if(![document,this.$refs.content].includes(i)&&!this.$refs.content.contains(i)&&this.activeZIndex>=this.getMaxZIndex()&&!this.getOpenDependentElements().some(function(t){return t.contains(i)})){var s=this.$refs.content.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');s.length&&s[0].focus()}},getActivator:function(t){if(this.$refs.activator)return this.$refs.activator.children.length>0?this.$refs.activator.children[0]:this.$refs.activator;if(t&&(this.activatedBy=t.currentTarget||t.target),this.activatedBy)return this.activatedBy;if(this.activatorNode){var e=Array.isArray(this.activatorNode)?this.activatorNode[0]:this.activatorNode,i=e&&e.elm;if(i)return i}Object(h["a"])("No activator found")},genActivator:function(){var t=this;if(!this.hasActivator)return null;var e=this.disabled?{}:{click:function(e){e.stopPropagation(),t.getActivator(e),t.disabled||(t.isActive=!t.isActive)}};if("scoped"===Object(d["k"])(this,"activator")){var i=this.$scopedSlots.activator({on:e});return this.activatorNode=i,i}return this.$createElement("div",{staticClass:"v-dialog__activator",class:{"v-dialog__activator--disabled":this.disabled},ref:"activator",on:e},this.$slots.activator)}},render:function(t){var e=this,i=[],s={class:this.classes,ref:"dialog",directives:[{name:"click-outside",value:function(){e.isActive=!1},args:{closeConditional:this.closeConditional,include:this.getOpenDependentElements}},{name:"show",value:this.isActive}],on:{click:function(t){t.stopPropagation()}}};this.fullscreen||(s.style={maxWidth:"none"===this.maxWidth?void 0:Object(d["b"])(this.maxWidth),width:"auto"===this.width?void 0:Object(d["b"])(this.width)}),i.push(this.genActivator());var o=t("div",s,this.showLazyContent(this.$slots.default));return this.transition&&(o=t("transition",{props:{name:this.transition,origin:this.origin}},[o])),i.push(t("div",{class:this.contentClasses,attrs:v({tabIndex:"-1"},this.getScopeIdAttrs()),on:{keydown:this.onKeydown},style:{zIndex:this.activeZIndex},ref:"content"},[this.$createElement(u["a"],{props:{root:!0,light:this.light,dark:this.dark}},[o])])),t("div",{staticClass:"v-dialog__container",style:{display:!this.hasActivator||this.fullWidth?"block":"inline-block"}},i)}}},"3e4a":function(t,e,i){},"5dbc":function(t,e,i){var s=i("d3f4"),o=i("8b97").set;t.exports=function(t,e,i){var a,n=e.constructor;return n!==i&&"function"==typeof n&&(a=n.prototype)!==i.prototype&&s(a)&&o&&o(t,a),t}},"60e8":function(t,e,i){},"632b":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.getPost?i("v-container",{staticClass:"pd0 mb-5",attrs:{flexbox:"",center:""}},[i("v-flex",{attrs:{xs12:"",sm10:"","offset-sm1":"",md8:"","offset-md2":""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",[i("v-card",{attrs:{hover:""}},[i("v-card-title",{staticClass:"py-2"},[i("v-list-tile-avatar",{directives:[{name:"push",rawName:"v-push:to",value:"/"+t.getPost.author.username,expression:"`/${getPost.author.username}`",arg:"to"}],attrs:{color:"grey light-3"}},[i("v-img",{staticClass:"elevation-6",attrs:{src:t.getPost.author.avatar}})],1),i("h2",{directives:[{name:"push",rawName:"v-push:to",value:"/"+t.getPost.author.username,expression:"`/${getPost.author.username}`",arg:"to"}],staticClass:"font-weight-regular"},[t._v("\n              "+t._s(t.getPost.author.username)+"\n            ")]),t.user?i("v-btn",{staticClass:"ml-3",attrs:{icon:""},on:{click:t.toggleLike}},[i("v-icon",{attrs:{middle:"",color:t.isPostLiked(t.getPost._id)?"red":"grey"}},[t._v("mdi-heart")])],1):t._e(),i("h3",{staticClass:"ml-2 font-weight-thin"},[t._v(t._s(t.getPost.likes)+" LIKES")]),i("v-spacer"),i("v-btn",{attrs:{icon:""},on:{click:function(e){return t.geToPreviousPage()}}},[i("v-icon",{attrs:{color:"info",large:""}},[t._v("mdi-arrow-left")])],1)],1),i("v-tooltip",{attrs:{right:""}},[i("span",[t._v("点击放大图片")]),i("v-img",{attrs:{slot:"activator","lazy-src":"https://picsum.photos/10/6?image=10",src:t.getPost.image.url,id:"post__image"},on:{click:t.toggleImageDialog},slot:"activator"})],1),i("v-dialog",{attrs:{"max-width":"80%"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[i("v-card",[i("v-img",{attrs:{"aspect-ratio":1,src:t.getPost.image.url,height:"100vh"},on:{click:t.toggleImageDialog}})],1)],1),i("v-card-text",[t._l(t.getPost.tags,function(e,s){return i("span",{key:s},[i("v-chip",{staticClass:"mb-3",attrs:{color:"accent","text-color":"white"}},[t._v(t._s(e))])],1)}),i("h3",{staticClass:"font-weight-regular"},[t._v(t._s(t.getPost.description))])],2)],1)],1)],1),i("div",{staticClass:"mt-3"},[t.user?i("v-layout",{},[i("v-flex",{attrs:{xs12:""}},[i("v-form",{ref:"form",attrs:{"lazy-validation":""},on:{submit:function(e){return e.preventDefault(),t.addPostComment(e)}},model:{value:t.isFormValid,callback:function(e){t.isFormValid=e},expression:"isFormValid"}},[i("v-layout",{attrs:{row:""}},[i("v-textarea",{attrs:{rules:t.commentRules,counter:"150",solo:"","auto-grow":"",rows:"2",clearable:"","append-icon":t.commentBody&&"mdi-send",label:"此刻的想法...",type:"text","prepend-inner-icon":"mdi-comment-outline",required:""},on:{"click:append":t.addPostComment},model:{value:t.commentBody,callback:function(e){t.commentBody=e},expression:"commentBody"}})],1)],1)],1)],1):t._e(),i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:""}},[i("v-list",{attrs:{subheader:"","two-line":""}},[i("v-subheader",[t._v("评论 ("+t._s(t.getPost.comments.length)+")")]),t._l(t.getPost.comments,function(e){return[i("v-divider",{key:e._id}),i("v-list-tile",{attrs:{avatar:""}},[i("v-list-tile-avatar",[i("img",{attrs:{src:e.user.avatar}})]),i("v-list-tile-content",[i("v-list-tile-title",[t._v(t._s(e.body))]),i("v-list-tile-sub-title",{directives:[{name:"push",rawName:"v-push:to",value:"/"+e.user.username,expression:"`/${comment.user.username}`",arg:"to"}]},[t._v(t._s(e.user.username)+"\n                    "),i("span",{staticClass:"grey--text text-lighten-1 hidden-xs-only"},[t._v(t._s(t.getTimeFromNow(e.created)))])])],1),i("v-list-tile-action",{staticClass:"hidden-xs-only"},[i("v-icon",{attrs:{color:t.isOwnComment(e)?"accent":"grey"}},[t._v("mdi-chat")])],1)],1)]})],2)],1)],1)],1)],1)],1):t._e()},o=[],a=(i("c5f6"),i("cebc")),n=i("c1df"),r=i.n(n),c=i("2f62"),l=i("39ff"),d={name:"Post",props:["postId"],data:function(){return{postLiked:!1,dialog:!1,commentBody:"",isFormValid:!0,commentRules:[function(t){return!!t||"内容不得为空"},function(t){return t&&t.length<=150||"字数不得超过150"}]}},apollo:{getPost:{query:l["e"],variables:function(){return{postId:this.postId}}}},computed:Object(a["a"])({},Object(c["b"])(["user","_user"])),methods:{getTimeFromNow:function(t){return r()(new Date(Number(t))).fromNow()},toggleLike:function(){this.likePost(!this.postLiked)},isPostLiked:function(){var t=this;return this.user.favorites&&this.user.favorites.some(function(e){return e._id===t.postId})?(this.postLiked=!0,!0):(this.postLiked=!1,!1)},geToPreviousPage:function(){this.$router.go(-1)},toggleImageDialog:function(){window.innerWidth>500&&(this.dialog=!this.dialog)},isOwnComment:function(t){return this.user&&this.user._id===t.user._id},addPostComment:function(){var t=this;if(this.$refs.form.validate()){var e={body:this.commentBody,userId:this.user._id,postId:this.postId};this.$apollo.mutate({mutation:l["b"],variables:e,update:function(e,i){var s=i.data.addPostComment,o=e.readQuery({query:l["e"],variables:{postId:t.postId}});o.getPost.commentsSize++,o.getPost.comments.unshift(s),e.writeQuery({query:l["e"],variables:{postId:t.postId},data:o}),console.log(e.readQuery({query:l["e"],variables:{postId:t.postId}}),e.readFragment({fragment:l["m"],id:"Post:"+t.postId}))}}).then(function(e){var i=e.data;t.$refs.form.reset(),console.log(i.addPostComment)}).catch(function(t){return console.error(t)})}},likePost:function(t){var e=this,i={postId:this.postId,username:this.user.username,isLike:t};this.$apollo.mutate({mutation:l["j"],variables:i,update:function(i,s){var o=s.data.likePost,a=i.readQuery({query:l["e"],variables:{postId:e.postId}});if(i.data.data.ROOT_QUERY['getUser({"username":"'+e.user.username+'"})']){console.log(o);var n=i.readFragment({fragment:l["t"],id:"User:"+e.user._id});n.favoritesSize=o.favorites.length,n.favorites=o.favorites,i.writeFragment({fragment:l["t"],id:"User:"+e.user._id,data:n}),console.log(i.readFragment({fragment:l["t"],id:"User:"+e.user._id}))}t||a.getPost.likes--,console.log(a.getPost,a.getPost.likes),i.writeQuery({query:l["e"],variables:{postId:e.postId},data:a})}}).then(function(t){var i=t.data;console.log("user",e.user),console.log("like post",i.likePost);var s=Object(a["a"])({},e.user,{favoritesSize:i.likePost.favorites.length,favorites:i.likePost.favorites});e.$store.commit("setUser",s)}).catch(function(t){return console.error(t)})}}},u=d,h=(i("db4b"),i("2877")),v=i("6544"),f=i.n(v),m=i("8336"),p=i("b0af"),g=i("99d9"),b=i("12b2"),y=i("cc20"),_=i("a523"),w=i("169a"),x=i("ce7e6"),k=i("0e8f"),I=i("4bd4"),A=i("132d"),C=i("adda"),P=i("a722"),O=i("8860"),T=i("ba95"),N=i("40fe"),$=i("c954"),S=i("5d23"),V=i("9910"),L=i("e0c7"),j=i("a844"),B=(i("60e8"),i("b64a")),E=i("163b"),F=i("c69d"),D=i("30d4"),W=i("b8d7"),z=i("98a1"),M=i("80d2"),R=i("d9bd");function q(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var U={name:"v-tooltip",mixins:[B["a"],E["a"],F["a"],D["a"],W["a"],z["a"]],props:{closeDelay:{type:[Number,String],default:200},debounce:{type:[Number,String],default:0},disabled:Boolean,fixed:{type:Boolean,default:!0},openDelay:{type:[Number,String],default:200},tag:{type:String,default:"span"},transition:String,zIndex:{default:null}},data:function(){return{calculatedMinWidth:0,closeDependents:!1}},computed:{calculatedLeft:function(){var t=this.dimensions,e=t.activator,i=t.content,s=!this.bottom&&!this.left&&!this.top&&!this.right,o=this.isAttached?e.offsetLeft:e.left,a=0;return this.top||this.bottom||s?a=o+e.width/2-i.width/2:(this.left||this.right)&&(a=o+(this.right?e.width:-i.width)+(this.right?10:-10)),this.nudgeLeft&&(a-=parseInt(this.nudgeLeft)),this.nudgeRight&&(a+=parseInt(this.nudgeRight)),this.calcXOverflow(a,this.dimensions.content.width)+"px"},calculatedTop:function(){var t=this.dimensions,e=t.activator,i=t.content,s=this.isAttached?e.offsetTop:e.top,o=0;return this.top||this.bottom?o=s+(this.bottom?e.height:-i.height)+(this.bottom?10:-10):(this.left||this.right)&&(o=s+e.height/2-i.height/2),this.nudgeTop&&(o-=parseInt(this.nudgeTop)),this.nudgeBottom&&(o+=parseInt(this.nudgeBottom)),this.calcYOverflow(o+this.pageYOffset)+"px"},classes:function(){return{"v-tooltip--top":this.top,"v-tooltip--right":this.right,"v-tooltip--bottom":this.bottom,"v-tooltip--left":this.left}},computedTransition:function(){return this.transition?this.transition:this.top?"slide-y-reverse-transition":this.right?"slide-x-transition":this.bottom?"slide-y-transition":this.left?"slide-x-reverse-transition":""},offsetY:function(){return this.top||this.bottom},offsetX:function(){return this.left||this.right},styles:function(){return{left:this.calculatedLeft,maxWidth:Object(M["b"])(this.maxWidth),minWidth:Object(M["b"])(this.minWidth),opacity:this.isActive?.9:0,top:this.calculatedTop,zIndex:this.zIndex||this.activeZIndex}}},beforeMount:function(){var t=this;this.$nextTick(function(){t.value&&t.callActivate()})},mounted:function(){"v-slot"===Object(M["k"])(this,"activator",!0)&&Object(R["a"])("v-tooltip's activator slot must be bound, try '<template #activator=\"data\"><v-btn v-on=\"data.on>'",this)},methods:{activate:function(){this.updateDimensions(),requestAnimationFrame(this.startTransition)},genActivator:function(){var t=this,e=this.disabled?{}:{mouseenter:function(e){t.getActivator(e),t.runDelay("open")},mouseleave:function(e){t.getActivator(e),t.runDelay("close")}};if("scoped"===Object(M["k"])(this,"activator")){var i=this.$scopedSlots.activator({on:e});return this.activatorNode=i,i}return this.$createElement("span",{on:e,ref:"activator"},this.$slots.activator)}},render:function(t){var e,i=t("div",this.setBackgroundColor(this.color,{staticClass:"v-tooltip__content",class:(e={},q(e,this.contentClass,!0),q(e,"menuable__content__active",this.isActive),q(e,"v-tooltip__content--fixed",this.activatorFixed),e),style:this.styles,attrs:this.getScopeIdAttrs(),directives:[{name:"show",value:this.isContentActive}],ref:"content"}),this.showLazyContent(this.$slots.default));return t(this.tag,{staticClass:"v-tooltip",class:this.classes},[t("transition",{props:{name:this.computedTransition}},[i]),this.genActivator()])}},Z=Object(h["a"])(u,s,o,!1,null,null,null);e["default"]=Z.exports;f()(Z,{VBtn:m["a"],VCard:p["a"],VCardText:g["b"],VCardTitle:b["a"],VChip:y["a"],VContainer:_["a"],VDialog:w["a"],VDivider:x["a"],VFlex:k["a"],VForm:I["a"],VIcon:A["a"],VImg:C["a"],VLayout:P["a"],VList:O["a"],VListTile:T["a"],VListTileAction:N["a"],VListTileAvatar:$["a"],VListTileContent:S["a"],VListTileSubTitle:S["b"],VListTileTitle:S["c"],VSpacer:V["a"],VSubheader:L["a"],VTextarea:j["a"],VTooltip:U})},"6ec0":function(t,e,i){},"8b97":function(t,e,i){var s=i("d3f4"),o=i("cb7c"),a=function(t,e){if(o(t),!s(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,s){try{s=i("9b43")(Function.call,i("11e9").f(Object.prototype,"__proto__").set,2),s(t,[]),e=!(t instanceof Array)}catch(o){e=!0}return function(t,i){return a(t,i),e?t.__proto__=i:s(t,i),t}}({},!1):void 0),check:a}},9093:function(t,e,i){var s=i("ce10"),o=i("e11e").concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,o)}},"99d9":function(t,e,i){"use strict";var s=i("80d2"),o=i("b0af"),a=i("adda"),n=i("d9bd"),r=a["a"].extend({name:"v-card-media",mounted:function(){Object(n["d"])("v-card-media",this.src?"v-img":"v-responsive",this)}}),c=i("12b2");i.d(e,"a",function(){return l}),i.d(e,"b",function(){return d});var l=Object(s["d"])("v-card__actions"),d=Object(s["d"])("v-card__text");o["a"],c["a"]},aa77:function(t,e,i){var s=i("5ca1"),o=i("be13"),a=i("79e5"),n=i("fdef"),r="["+n+"]",c="​",l=RegExp("^"+r+r+"*"),d=RegExp(r+r+"*$"),u=function(t,e,i){var o={},r=a(function(){return!!n[t]()||c[t]()!=c}),l=o[t]=r?e(h):n[t];i&&(o[i]=l),s(s.P+s.F*r,"String",o)},h=u.trim=function(t,e){return t=String(o(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(d,"")),t};t.exports=u},c5f6:function(t,e,i){"use strict";var s=i("7726"),o=i("69a8"),a=i("2d95"),n=i("5dbc"),r=i("6a99"),c=i("79e5"),l=i("9093").f,d=i("11e9").f,u=i("86cc").f,h=i("aa77").trim,v="Number",f=s[v],m=f,p=f.prototype,g=a(i("2aeb")(p))==v,b="trim"in String.prototype,y=function(t){var e=r(t,!1);if("string"==typeof e&&e.length>2){e=b?e.trim():h(e,3);var i,s,o,a=e.charCodeAt(0);if(43===a||45===a){if(i=e.charCodeAt(2),88===i||120===i)return NaN}else if(48===a){switch(e.charCodeAt(1)){case 66:case 98:s=2,o=49;break;case 79:case 111:s=8,o=55;break;default:return+e}for(var n,c=e.slice(2),l=0,d=c.length;l<d;l++)if(n=c.charCodeAt(l),n<48||n>o)return NaN;return parseInt(c,s)}}return+e};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof f&&(g?c(function(){p.valueOf.call(i)}):a(i)!=v)?n(new m(y(e)),i,f):y(e)};for(var _,w=i("9e1e")?l(m):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;w.length>x;x++)o(m,_=w[x])&&!o(f,_)&&u(f,_,d(m,_));f.prototype=p,p.constructor=f,i("2aba")(s,v,f)}},db4b:function(t,e,i){"use strict";var s=i("3e4a"),o=i.n(s);o.a},fdef:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);