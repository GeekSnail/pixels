(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["userPosts"],{"12b2":function(t,e,s){"use strict";var i=s("2b0e");e["a"]=i["a"].extend({name:"v-card-title",functional:!0,props:{primaryTitle:Boolean},render:function(t,e){var s=e.data,i=e.props,a=e.children;return s.staticClass=("v-card__title "+(s.staticClass||"")).trim(),i.primaryTitle&&(s.staticClass+=" v-card__title--primary"),t("div",s,a)}})},"169a":function(t,e,s){"use strict";s("6ec0");var i=s("c69d"),a=s("30d4"),o=s("14ec"),n=s("e949"),r=s("261e"),c=s("98a1"),l=s("c584"),d=s("80d2"),u=s("bfc5"),h=s("d9bd"),v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t};function f(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}e["a"]={name:"v-dialog",directives:{ClickOutside:l["a"]},mixins:[i["a"],a["a"],o["a"],n["a"],r["a"],c["a"]],props:{disabled:Boolean,persistent:Boolean,fullscreen:Boolean,fullWidth:Boolean,noClickAnimation:Boolean,light:Boolean,dark:Boolean,maxWidth:{type:[String,Number],default:"none"},origin:{type:String,default:"center center"},width:{type:[String,Number],default:"auto"},scrollable:Boolean,transition:{type:[String,Boolean],default:"dialog-transition"}},data:function(){return{animate:!1,animateTimeout:null,stackClass:"v-dialog__content--active",stackMinZIndex:200}},computed:{classes:function(){var t;return t={},f(t,("v-dialog "+this.contentClass).trim(),!0),f(t,"v-dialog--active",this.isActive),f(t,"v-dialog--persistent",this.persistent),f(t,"v-dialog--fullscreen",this.fullscreen),f(t,"v-dialog--scrollable",this.scrollable),f(t,"v-dialog--animated",this.animate),t},contentClasses:function(){return{"v-dialog__content":!0,"v-dialog__content--active":this.isActive}},hasActivator:function(){return Boolean(!!this.$slots.activator||!!this.$scopedSlots.activator)}},watch:{isActive:function(t){t?(this.show(),this.hideScroll()):(this.removeOverlay(),this.unbind())},fullscreen:function(t){this.isActive&&(t?(this.hideScroll(),this.removeOverlay(!1)):(this.showScroll(),this.genOverlay()))}},beforeMount:function(){var t=this;this.$nextTick(function(){t.isBooted=t.isActive,t.isActive&&t.show()})},mounted:function(){"v-slot"===Object(d["k"])(this,"activator",!0)&&Object(h["a"])("v-dialog's activator slot must be bound, try '<template #activator=\"data\"><v-btn v-on=\"data.on>'",this)},beforeDestroy:function(){"undefined"!==typeof window&&this.unbind()},methods:{animateClick:function(){var t=this;this.animate=!1,this.$nextTick(function(){t.animate=!0,clearTimeout(t.animateTimeout),t.animateTimeout=setTimeout(function(){return t.animate=!1},150)})},closeConditional:function(t){return!(!this.isActive||this.$refs.content.contains(t.target))&&(this.persistent?(this.noClickAnimation||this.overlay!==t.target||this.animateClick(),!1):this.activeZIndex>=this.getMaxZIndex())},hideScroll:function(){this.fullscreen?document.documentElement.classList.add("overflow-y-hidden"):o["a"].options.methods.hideScroll.call(this)},show:function(){!this.fullscreen&&!this.hideOverlay&&this.genOverlay(),this.$refs.content.focus(),this.bind()},bind:function(){window.addEventListener("focusin",this.onFocusin)},unbind:function(){window.removeEventListener("focusin",this.onFocusin)},onKeydown:function(t){if(t.keyCode===d["n"].esc&&!this.getOpenDependents().length)if(this.persistent)this.noClickAnimation||this.animateClick();else{this.isActive=!1;var e=this.getActivator();this.$nextTick(function(){return e&&e.focus()})}this.$emit("keydown",t)},onFocusin:function(t){var e=event,s=e.target;if(![document,this.$refs.content].includes(s)&&!this.$refs.content.contains(s)&&this.activeZIndex>=this.getMaxZIndex()&&!this.getOpenDependentElements().some(function(t){return t.contains(s)})){var i=this.$refs.content.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');i.length&&i[0].focus()}},getActivator:function(t){if(this.$refs.activator)return this.$refs.activator.children.length>0?this.$refs.activator.children[0]:this.$refs.activator;if(t&&(this.activatedBy=t.currentTarget||t.target),this.activatedBy)return this.activatedBy;if(this.activatorNode){var e=Array.isArray(this.activatorNode)?this.activatorNode[0]:this.activatorNode,s=e&&e.elm;if(s)return s}Object(h["a"])("No activator found")},genActivator:function(){var t=this;if(!this.hasActivator)return null;var e=this.disabled?{}:{click:function(e){e.stopPropagation(),t.getActivator(e),t.disabled||(t.isActive=!t.isActive)}};if("scoped"===Object(d["k"])(this,"activator")){var s=this.$scopedSlots.activator({on:e});return this.activatorNode=s,s}return this.$createElement("div",{staticClass:"v-dialog__activator",class:{"v-dialog__activator--disabled":this.disabled},ref:"activator",on:e},this.$slots.activator)}},render:function(t){var e=this,s=[],i={class:this.classes,ref:"dialog",directives:[{name:"click-outside",value:function(){e.isActive=!1},args:{closeConditional:this.closeConditional,include:this.getOpenDependentElements}},{name:"show",value:this.isActive}],on:{click:function(t){t.stopPropagation()}}};this.fullscreen||(i.style={maxWidth:"none"===this.maxWidth?void 0:Object(d["b"])(this.maxWidth),width:"auto"===this.width?void 0:Object(d["b"])(this.width)}),s.push(this.genActivator());var a=t("div",i,this.showLazyContent(this.$slots.default));return this.transition&&(a=t("transition",{props:{name:this.transition,origin:this.origin}},[a])),s.push(t("div",{class:this.contentClasses,attrs:v({tabIndex:"-1"},this.getScopeIdAttrs()),on:{keydown:this.onKeydown},style:{zIndex:this.activeZIndex},ref:"content"},[this.$createElement(u["a"],{props:{root:!0,light:this.light,dark:this.dark}},[a])])),t("div",{staticClass:"v-dialog__container",style:{display:!this.hasActivator||this.fullWidth?"block":"inline-block"}},s)}}},"1a3f":function(t,e,s){},"1de0":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-container",[s("v-img",{staticClass:"mx-auto round",attrs:{width:"135px",contain:"",fab:"",src:t.posts?t.posts[0]:"https://picsum.photos/10/6?image=8"}}),s("v-flex",{attrs:{xs12:""}}),s("v-layout",{attrs:{row:"",wrap:""}},t._l(t.posts,function(e,i){return t.posts?s("v-flex",{key:e._id,attrs:{xs12:"",sm6:"",md4:""}},[s("v-hover",{scopedSlots:t._u([{key:"default",fn:function(a){var o=a.hover;return e.image?s("v-card",{staticClass:"mt-3 ml-1 mr-2 mx-auto",attrs:{hover:""}},[s("v-img",{attrs:{height:"30vh",src:e.image.url,"lazy-src":"https://picsum.photos/10/6?image="+(4*i+10)},nativeOn:{click:function(s){return t.goToPost(e._id)}}},[s("v-layout",[o?s("div",{staticClass:"d-flex black v-card--reveal display-1 white--text",staticStyle:{height:"100%"}}):t._e(),o?s("v-layout",{staticClass:"v-card--reveal opc-1",attrs:{"align-center":"","justify-center":""}},[s("v-icon",{staticClass:"mr-1",attrs:{color:"white"}},[t._v("mdi-heart")]),s("span",{staticClass:"subheading mr-3 white--text",attrs:{color:"white"}},[t._v(t._s(e.likes))]),s("v-icon",{staticClass:"mr-1",attrs:{color:"white"}},[t._v("mdi-comment")]),s("span",{staticClass:"subheading white--text"},[t._v(t._s(e.commentsSize))])],1):t._e()],1)],1),s("v-card-actions",{staticClass:"cardTextH"},[s("v-card-text",[t._v(t._s(e.description))]),t.user&&e.createdBy===t.user.username?s("v-flex",{attrs:{shrink:""}},[s("v-expand-x-transition",[s("div",{directives:[{name:"show",rawName:"v-show",value:o,expression:"hover"}],staticStyle:{"white-space":"nowrap"}},[s("v-btn",{attrs:{flat:"",fab:"",small:""},on:{click:function(s){return t.loadPost(e)}}},[s("v-icon",[t._v("mdi-pencil")])],1),s("v-btn",{attrs:{color:"",flat:"",fab:"",small:""},on:{click:function(s){return t.deleteUserPost(e)}}},[s("v-icon",[t._v("mdi-delete")])],1)],1)])],1):t._e()],1)],1):t._e()}}],null,!0)})],1):t._e()}),1),s("v-dialog",{attrs:{lazy:"",persistent:"","min-width":"600px","max-width":"100%"},model:{value:t.isEditDialog,callback:function(e){t.isEditDialog=e},expression:"isEditDialog"}},[s("v-flex",{attrs:{xs12:"",sm10:"","offset-sm1":"",md8:"","offset-md2":"",lg6:"","offset-lg3":""}},[s("v-card",[s("v-card-title",{staticClass:"headline grey lighten-2"},[t._v("更新帖子")]),s("v-container",[t.post?s("v-layout",[s("v-flex",{ref:"preview",attrs:{xs7:"","pr-4":"","pb-5":"","my-auto":"","hidden-sm-only":"","hidden-xs-only":""}},[s("v-img",{staticClass:"d-block mx-auto",attrs:{src:t.post.image.url,height:"350px",contain:""}})],1),s("v-flex",[s("v-form",{ref:"form",attrs:{xs7:"","lazy-validation":""},on:{submit:function(e){return e.preventDefault(),t.updateUserPost(e)}},model:{value:t.isFormValid,callback:function(e){t.isFormValid=e},expression:"isFormValid"}},[s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs12:""}},[s("v-text-field",{attrs:{label:"上传照片",value:t.post.image.url,"prepend-icon":"mdi-cloud-upload-outline",readOnly:"",disabled:""}})],1)],1),[s("v-combobox",{attrs:{items:t.tagsSearchList,label:"标签",tags:"",clearable:"","prepend-icon":"mdi-tag-text-outline",multiple:""},scopedSlots:t._u([{key:"selection",fn:function(e){return[s("v-chip",{attrs:{selected:e.selected,close:""},on:{input:function(s){return t.remove(e.item)}}},[s("strong",[t._v(t._s(e.item))]),t._v(" \n                      ")])]}}],null,!1,78345935),model:{value:t.post.tags,callback:function(e){t.$set(t.post,"tags",e)},expression:"post.tags"}})],s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs12:""}},[s("v-textarea",{attrs:{rules:t.descRules,"prepend-icon":"mdi-card-text-outline",label:"描述",type:"text",required:""},model:{value:t.post.description,callback:function(e){t.$set(t.post,"description",e)},expression:"post.description"}})],1)],1),s("v-divider"),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{disabled:!t.isFormValid,type:"submit",color:"green darken-1",flat:""}},[t._v("保存")]),s("v-btn",{staticClass:"error--text",attrs:{flat:""},on:{click:function(e){t.isEditDialog=!1}}},[t._v("取消")])],1)],2)],1)],1):t._e()],1)],1)],1)],1)],1)},a=[],o=(s("20d6"),s("96cf"),s("3b8d")),n=s("75fc"),r=s("cebc"),c=s("2f62"),l={name:"Profile",data:function(){return{posts:[],isUserPosts:!0,isEditDialog:!1,isFormValid:!0,post:null,tagsSearchList:["art","Education","Travel","Photography","Technology"],imageRules:[function(t){return!!t||"照片不得为空"}],descRules:[function(t){return!!t||"描述不得为空"},function(t){return!!t&&t.length<=150||"描述至多150个字符"}]}},computed:Object(r["a"])({},Object(c["b"])(["user","_user"])),created:function(){this.changePostsByRoute(this.$route),console.log("_user.posts cr",!!this._user&&this._user.posts)},watch:{_user:function(t,e){console.log("watch",t,e),this.changePostsByRoute(this.$route)},user:function(t,e){console.log("watch",t,e),this.changePostsByRoute(this.$route)}},mounted:function(){this.$store.watch(function(t,e){return e._user},function(t,e){console.log(t,e)})},methods:Object(r["a"])({},Object(c["c"])(["set_user"]),{changePostsByRoute:function(t){console.log("to",t,this.$route),t.path.lastIndexOf("/likes")<=0&&t.params.hasOwnProperty("username")?(console.log("userpost"),this.isUserPosts=!0,this._user?this._user.posts||0===this._user.postsSize?this.posts=this._user.posts||[]:this.getUser(t.params.username):(console.log("[usrPosts] had not _user"),this.getUser(t.params.username))):t.params.hasOwnProperty("username")&&(console.log("likes"),this.isUserPosts=!1,this._user?this._user.favorites||0===this._user.favoritesSize?this.posts=this._user.favorites||[]:this.getUser(t.params.username,!1,!0):(console.log("[userPosts] had not _user"),this.getUser(t.params.username)))},getUser:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];console.log("getUser",e,s),this.$store.dispatch("getUser",{username:t,withPosts:e,withFavorites:s})},goToPost:function(t){this.$router.push("/posts/".concat(t))},loadPost:function(t){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.post=t},remove:function(t){this.tags.splice(this.tags.indexOf(t),1),this.tags=Object(n["a"])(this.tags)},updateUserPost:function(){this.$refs.form.validate()&&(this.$store.dispatch("updateUserPost",{postId:this.post._id,userId:this.user._id,tags:this.post.tags,description:this.post.description}),this.isEditDialog=!1)},deleteUserPost:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(e){var s,i=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.loadPost(e,!1),s=window.confirm("你确定要删除这个帖子？"),s&&this.$store.dispatch("deleteUserPost",{postId:this.post._id,username:this.user.username}).then(function(){var t=i._user.posts.findIndex(function(t){return t._id===e._id});i._user.posts.splice(t,1),i._user.postsSize--});case 3:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}()}),beforeRouteUpdate:function(t,e,s){console.log("[userPosts] beforeUpdate",t,e,this._user.username),s()},beforeRouteLeave:function(t,e,s){console.log("[userPosts] beforeLeave"),this.changePostsByRoute(t),s()}},d=l,u=(s("7be5"),s("2877")),h=s("6544"),v=s.n(h),f=s("8336"),p=s("b0af"),m=s("99d9"),g=s("12b2"),b=s("cc20"),y=s("2b5d"),x=s("a523"),_=s("169a"),w=s("ce7e6"),k=s("0789"),C=s("0e8f"),$=s("4bd4"),O=s("163b"),A=s("98a1"),P=s("58df"),S=s("d9bd"),V=Object(P["a"])(O["a"],A["a"]).extend({name:"v-hover",props:{disabled:{type:Boolean,default:!1},value:{type:Boolean,default:void 0}},methods:{onMouseEnter:function(){this.runDelay("open")},onMouseLeave:function(){this.runDelay("close")}},render:function(){if(!this.$scopedSlots.default&&void 0===this.value)return Object(S["c"])("v-hover is missing a default scopedSlot or bound value",this),null;var t=void 0;return this.$scopedSlots.default?t=this.$scopedSlots.default({hover:this.isActive}):this.$slots.default&&1===this.$slots.default.length&&(t=this.$slots.default[0]),Array.isArray(t)&&1===t.length&&(t=t[0]),t&&!Array.isArray(t)&&t.tag?(this.disabled||(t.data=t.data||{},this._g(t.data,{mouseenter:this.onMouseEnter,mouseleave:this.onMouseLeave})),t):(Object(S["c"])("v-hover should only contain a single element",this),t)}}),B=s("132d"),j=s("adda"),T=s("a722"),E=s("9910"),U=s("2677"),I=s("a844"),D=Object(u["a"])(d,i,a,!1,null,"7c39c296",null);e["default"]=D.exports;v()(D,{VBtn:f["a"],VCard:p["a"],VCardActions:m["a"],VCardText:m["b"],VCardTitle:g["a"],VChip:b["a"],VCombobox:y["a"],VContainer:x["a"],VDialog:_["a"],VDivider:w["a"],VExpandXTransition:k["b"],VFlex:C["a"],VForm:$["a"],VHover:V,VIcon:B["a"],VImg:j["a"],VLayout:T["a"],VSpacer:E["a"],VTextField:U["a"],VTextarea:I["a"]})},"6ec0":function(t,e,s){},"7be5":function(t,e,s){"use strict";var i=s("1a3f"),a=s.n(i);a.a},"99d9":function(t,e,s){"use strict";var i=s("80d2"),a=s("b0af"),o=s("adda"),n=s("d9bd"),r=o["a"].extend({name:"v-card-media",mounted:function(){Object(n["d"])("v-card-media",this.src?"v-img":"v-responsive",this)}}),c=s("12b2");s.d(e,"a",function(){return l}),s.d(e,"b",function(){return d});var l=Object(i["d"])("v-card__actions"),d=Object(i["d"])("v-card__text");a["a"],c["a"]}}]);