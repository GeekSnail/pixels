(function(e){function t(t){for(var r,o,i=t[0],u=t[1],c=t[2],l=0,d=[];l<i.length;l++)o=i[l],s[o]&&d.push(s[o][0]),s[o]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);f&&f(t);while(d.length)d.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,o=1;o<n.length;o++){var i=n[o];0!==s[i]&&(r=!1)}r&&(a.splice(t--,1),e=u(u.s=n[0]))}return e}var r={},o={app:0},s={app:0},a=[];function i(e){return u.p+"js/"+({NotFound:"NotFound","Post~Posts~profile":"Post~Posts~profile",Posts:"Posts","Post~Upload~userPosts":"Post~Upload~userPosts",Post:"Post",profile:"profile","Upload~userPosts":"Upload~userPosts",Upload:"Upload",userPosts:"userPosts","group-signinOrup":"group-signinOrup",home:"home"}[e]||e)+"."+{NotFound:"2a15b4af","Post~Posts~profile":"33fcf4b3",Posts:"de216c98","Post~Upload~userPosts":"8418060d",Post:"141851b3",profile:"e16399dd","Upload~userPosts":"5378fcb4",Upload:"86f467bd",userPosts:"035eaa55","group-signinOrup":"e7e34d1b",home:"6438a8a4"}[e]+".js"}function u(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.e=function(e){var t=[],n={"Post~Upload~userPosts":1,Post:1,profile:1,"Upload~userPosts":1,userPosts:1,"group-signinOrup":1,home:1};o[e]?t.push(o[e]):0!==o[e]&&n[e]&&t.push(o[e]=new Promise(function(t,n){for(var r="css/"+({NotFound:"NotFound","Post~Posts~profile":"Post~Posts~profile",Posts:"Posts","Post~Upload~userPosts":"Post~Upload~userPosts",Post:"Post",profile:"profile","Upload~userPosts":"Upload~userPosts",Upload:"Upload",userPosts:"userPosts","group-signinOrup":"group-signinOrup",home:"home"}[e]||e)+"."+{NotFound:"31d6cfe0","Post~Posts~profile":"31d6cfe0",Posts:"31d6cfe0","Post~Upload~userPosts":"2af723ef",Post:"0095fe42",profile:"43618fdf","Upload~userPosts":"e593d21f",Upload:"31d6cfe0",userPosts:"aba7ae06","group-signinOrup":"35a0e072",home:"93ab2bd5"}[e]+".css",s=u.p+r,a=document.getElementsByTagName("link"),i=0;i<a.length;i++){var c=a[i],l=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(l===r||l===s))return t()}var d=document.getElementsByTagName("style");for(i=0;i<d.length;i++){c=d[i],l=c.getAttribute("data-href");if(l===r||l===s)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var r=t&&t.target&&t.target.src||s,a=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=r,delete o[e],f.parentNode.removeChild(f),n(a)},f.href=s;var p=document.getElementsByTagName("head")[0];p.appendChild(f)}).then(function(){o[e]=0}));var r=s[e];if(0!==r)if(r)t.push(r[2]);else{var a=new Promise(function(t,n){r=s[e]=[t,n]});t.push(r[2]=a);var c,l=document.createElement("script");l.charset="utf-8",l.timeout=120,u.nc&&l.setAttribute("nonce",u.nc),l.src=i(e),c=function(t){l.onerror=l.onload=null,clearTimeout(d);var n=s[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src,a=new Error("Loading chunk "+e+" failed.\n("+r+": "+o+")");a.type=r,a.request=o,n[1](a)}s[e]=void 0}};var d=setTimeout(function(){c({type:"timeout",target:l})},12e4);l.onerror=l.onload=c,document.head.appendChild(l)}return Promise.all(t)},u.m=e,u.c=r,u.d=function(e,t,n){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)u.d(n,r,function(t){return e[t]}.bind(null,r));return n},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="/",u.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var d=0;d<c.length;d++)t(c[d]);var f=l;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"39ff":function(e,t,n){"use strict";n.d(t,"f",function(){return w}),n.d(t,"e",function(){return j}),n.d(t,"p",function(){return C}),n.d(t,"h",function(){return x}),n.d(t,"n",function(){return T}),n.d(t,"d",function(){return E}),n.d(t,"g",function(){return q}),n.d(t,"t",function(){return L}),n.d(t,"m",function(){return N}),n.d(t,"i",function(){return R}),n.d(t,"a",function(){return z}),n.d(t,"s",function(){return B}),n.d(t,"c",function(){return A}),n.d(t,"b",function(){return V}),n.d(t,"j",function(){return D}),n.d(t,"q",function(){return F}),n.d(t,"r",function(){return Q}),n.d(t,"k",function(){return H}),n.d(t,"l",function(){return W}),n.d(t,"o",function(){return M});var r=n("aede"),o=n("9530"),s=n.n(o);function a(){var e=Object(r["a"])(["\n  subscription {\n    postCreated {\n      _id\n      image {\n        url\n        naturalWidth\n        naturalHeight\n      }\n    }\n  }\n"]);return a=function(){return e},e}function i(){var e=Object(r["a"])(["\n  subscription {\n    msgCreated {\n      id\n      content\n    }\n  }\n"]);return i=function(){return e},e}function u(){var e=Object(r["a"])(['\n  mutation {\n    addMsg(id: 3, content: "world")\n  }\n']);return u=function(){return e},e}function c(){var e=Object(r["a"])(["\n  query {\n    msgs {\n      id\n      content\n    }\n  }\n"]);return c=function(){return e},e}function l(){var e=Object(r["a"])(["\n  mutation($username: String!, $email: String!, $password: String!) {\n    signupUser(username: $username, email: $email, password: $password) {\n      token\n    }\n  }\n"]);return l=function(){return e},e}function d(){var e=Object(r["a"])(["\n  mutation($email: String!, $password: String!) {\n    signinUser(email: $email, password: $password) {\n      token\n    }\n  }\n"]);return d=function(){return e},e}function f(){var e=Object(r["a"])(["\n  mutation($postId: ID!, $username: String!, $isLike: Boolean!) {\n    likePost(postId: $postId, username: $username, isLike: $isLike) {\n      likes\n      favorites {\n        _id\n        image {\n          url\n        }\n        description\n        tags\n        created\n        createdBy\n        likes\n        commentsSize\n      }\n    }\n  }\n"]);return f=function(){return e},e}function p(){var e=Object(r["a"])(["\n  mutation($body: String!, $userId: ID!, $postId: ID!) {\n    addPostComment(body: $body, userId: $userId, postId: $postId) {\n      _id\n      body\n      created\n      user {\n        _id\n        username\n        avatar\n      }\n    }\n  }\n"]);return p=function(){return e},e}function g(){var e=Object(r["a"])(["\n  mutation($postId: ID!, $username: String!) {\n    deleteUserPost(postId: $postId, username: $username) {\n      _id\n    }\n  }\n"]);return g=function(){return e},e}function m(){var e=Object(r["a"])(["\n  mutation($postId: ID!, $userId: ID!, $tags: [String], $description: String!) {\n    updateUserPost(\n      postId: $postId\n      userId: $userId\n      tags: $tags\n      description: $description\n    ) {\n      _id\n      image {\n        url\n      }\n      tags\n      description\n      created\n      likes\n      author {\n        _id\n        avatar\n      }\n    }\n  }\n"]);return m=function(){return e},e}function h(){var e=Object(r["a"])(["\n  mutation ADD_POST_(\n    $imageUrl: String!\n    $tags: [String]!\n    $description: String!\n    $userId: ID!\n  ) {\n    addPost_(\n      # title: $title\n      imageUrl: $imageUrl\n      tags: $tags\n      description: $description\n      userId: $userId\n    ) @client\n  }\n"]);return h=function(){return e},e}function v(){var e=Object(r["a"])(["\n  mutation(\n    $image: Upload!\n    $naturalWidth: Int!\n    $naturalHeight: Int!\n    $tags: [String]\n    $description: String!\n    $userId: ID!\n  ) {\n    addPost(\n      image: $image\n      naturalWidth: $naturalWidth\n      naturalHeight: $naturalHeight\n      tags: $tags\n      description: $description\n      userId: $userId\n    ) {\n      _id\n      image {\n        url\n        naturalWidth\n        naturalHeight\n      }\n      # tags\n      # description\n      # created\n      createdBy\n    }\n  }\n"]);return v=function(){return e},e}function b(){var e=Object(r["a"])(["\n  query($pageNum: Int!, $pageSize: Int!) {\n    infiniteScrollPosts(pageNum: $pageNum, pageSize: $pageSize) {\n      hasMore\n      posts {\n        _id\n        image {\n          url\n          naturalWidth\n          naturalHeight\n        }\n        tags\n        description\n        likes\n        created\n        createdBy\n        author {\n          _id\n          username\n          email\n          avatar\n          created\n        }\n      }\n    }\n  }\n"]);return b=function(){return e},e}function P(){var e=Object(r["a"])(["\n  fragment post on Post {\n    __typename\n    _id\n    image {\n      url\n      naturalWidth\n      naturalHeight\n    }\n    description\n    created\n    createdBy\n    likes\n    commentsSize\n  }\n"]);return P=function(){return e},e}function _(){var e=Object(r["a"])(["\n  fragment user on User {\n    __typename\n    _id\n    username\n    avatar\n    created\n    favorites {\n      _id\n    }\n    postsSize\n    favoritesSize\n  }\n"]);return _=function(){return e},e}function y(){var e=Object(r["a"])(["\n  query(\n    $username: String!\n    $withUser: Boolean = true\n    $withPosts: Boolean = true\n    $withFavorites: Boolean = false\n    $withComments: Boolean = false\n  ) {\n    getUser(username: $username) {\n      ...user @include(if: $withUser)\n      posts @include(if: $withPosts) {\n        ...post\n      }\n      favorites @include(if: $withFavorites) {\n        ...post\n      }\n    }\n  }\n  fragment user on User {\n    _id\n    username\n    avatar\n    created\n    postsSize\n    favoritesSize\n  }\n  fragment post on Post {\n    _id\n    image {\n      url\n      naturalWidth\n      naturalHeight\n    }\n    description\n    created\n    createdBy\n    likes\n    commentsSize\n    comments @include(if: $withComments) {\n      ...comment\n    }\n  }\n  fragment comment on Comment {\n    _id\n    body\n    created\n    user {\n      ...user\n    }\n  }\n"]);return y=function(){return e},e}function k(){var e=Object(r["a"])(["\n  # query {\n  #   getCurrentUser {\n  #     _id\n  #     email\n  #     username\n  #     avatar\n  #     created\n  #     postsSize\n  #     favoritesSize\n  #     favorites {\n  #       _id\n  #       # title\n  #       image {\n  #         url\n  #       }\n  #       likes\n  #       createdBy\n  #       commentsSize\n  #     }\n  #   }\n  # }\n  query {\n    getCurrentUser {\n      _id\n      email\n      username\n      avatar\n      created\n      postsSize\n      favoritesSize\n      favorites {\n        _id\n      }\n      # collectionsSize\n    }\n  }\n"]);return k=function(){return e},e}function U(){var e=Object(r["a"])(["\n  query($ids: [ID]!) {\n    postsByIds(ids: $ids) {\n      _id\n      image {\n        url\n      }\n      description\n      tags\n      created\n      createdBy\n      likes\n      commentsSize\n    }\n  }\n"]);return U=function(){return e},e}function S(){var e=Object(r["a"])(["\n  query($username: String!) {\n    getUserPosts(username: $username) {\n      _id\n      # title\n      image {\n        url\n      }\n      description\n      tags\n      created\n      createdBy\n      likes\n      commentsSize\n    }\n  }\n"]);return S=function(){return e},e}function $(){var e=Object(r["a"])(["\n  query($searchTerm: String!) {\n    searchPosts(searchTerm: $searchTerm) {\n      _id\n      # title\n      description\n      image {\n        url\n      }\n      likes\n    }\n  }\n"]);return $=function(){return e},e}function O(){var e=Object(r["a"])(["\n  query($postId: ID!) {\n    getPost(postId: $postId) {\n      _id\n      image {\n        url\n        naturalWidth\n        naturalHeight\n      }\n      tags\n      description\n      likes\n      created\n      createdBy\n      author {\n        _id\n        username\n        avatar\n        created\n      }\n      commentsSize\n      comments {\n        _id\n        body\n        created\n        user {\n          _id\n          username\n          avatar\n        }\n      }\n    }\n  }\n"]);return O=function(){return e},e}function I(){var e=Object(r["a"])(["\n  query {\n    getPosts {\n      _id\n      # title\n      image {\n        url\n      }\n    }\n    # Post @client {\n    #   _id\n    #   imageUrl\n    # }\n  }\n"]);return I=function(){return e},e}var w=s()(I()),j=s()(O()),C=s()($()),x=s()(S()),T=s()(U()),E=s()(k()),q=s()(y()),L=s()(_()),N=s()(P()),R=s()(b()),z=s()(v()),B=(s()(h()),s()(m())),A=s()(g()),V=s()(p()),D=s()(f()),F=s()(d()),Q=s()(l()),H=s()(c()),W=(s()(u()),s()(i())),M=s()(a())},"56d7":function(e,t,n){"use strict";n.r(t);var r=n("cebc"),o=(n("7f7f"),n("5d73")),s=n.n(o),a=n("795b"),i=n.n(a),u=(n("cadf"),n("551c"),n("f751"),n("097d"),n("2b0e")),c=n("bb71");n("da64");u["a"].use(c["a"],{iconfont:"mdi",theme:{primary:"#232a34",secondary:"#fafafa",accent:"#bf653f",error:"#ff5252",warning:"#A34513",info:"#2196f3",success:"#4caf50"}});var l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",{attrs:{color:"secondary"},nativeOn:{click:function(t){e.globalClicked=!0}}},[r("v-navigation-drawer",{attrs:{app:"",temporary:"",fixed:""},model:{value:e.sideNav,callback:function(t){e.sideNav=t},expression:"sideNav"}},[r("v-img",{attrs:{"aspect-ratio":16/9,src:n("86cc4")}},[r("v-layout",{staticClass:"lightbox ",attrs:{"pa-2":"",column:"","fill-height":""}},[r("v-toolbar-side-icon",{on:{click:e.toggleSideNav}}),e.user?r("v-layout",{staticClass:"ml-3",attrs:{column:"",shrink:""}},[r("div",{staticClass:"subheading white--text"},[e._v(e._s(e.user.username))]),r("div",{staticClass:"body-1 mt-1 white--text"},[e._v(e._s(e.user.email))])]):e._e()],1)],1),r("v-divider"),r("v-list",{staticClass:"pl-2"},[e._l(e.sideNavItems,function(t){return r("v-list-tile",{key:t.title,attrs:{ripple:"",to:t.link}},[r("v-list-tile-action",[r("v-icon",[e._v(e._s(t.icon))])],1),r("v-list-tile-content",[e._v(e._s(t.title))])],1)}),e.user?r("v-list-tile",{attrs:{to:"/"+e.user.username}},[r("v-list-tile-action",[r("v-img",{staticClass:"grey lighten-2 mr-32 round",attrs:{src:e.user.avatar,"aspect-ratio":"1"}})],1),r("v-list-tile-content",[e._v("我的")])],1):e._e(),e.user?r("v-list-tile",{on:{click:e.signoutUser}},[r("v-list-tile-action",[r("v-icon",[e._v("mdi-logout")])],1),r("v-list-tile-content",[e._v("注销")])],1):e._e()],2)],1),r("v-toolbar",{attrs:{app:"",fixed:"",color:"primary"}},[r("v-toolbar-side-icon",{on:{click:e.toggleSideNav}}),r("v-toolbar-title",{class:{headline:!0,"hidden-xs-only":e.hiddenTitle}},[r("router-link",{staticClass:"white--text",staticStyle:{cursor:"pointer"},attrs:{to:"/",tag:"span"}},[e._v("\n        Pixels\n      ")])],1),r("v-spacer"),r("v-text-field",{staticClass:"searchField",attrs:{solo:!0,flex:"","append-icon":"mdi-magnify",placeholder:"搜索图片","single-line":"","hide-details":"",height:"30px"},on:{input:e.searchPosts,focus:function(t){e.hiddenTitle=!0,e.globalClicked=!1},blur:function(t){e.hiddenTitle=!1},click:function(t){t.stopPropagation(),e.globalClicked=!1}},model:{value:e.searchTerm,callback:function(t){e.searchTerm=t},expression:"searchTerm"}}),r("v-spacer",{staticClass:"hidden-xs-only"}),this.searchResults&&this.searchResults.length&&!e.globalClicked?r("v-card",{attrs:{color:"#fafafa",id:"search__card"}},[r("v-list",e._l(e.searchResults,function(t){return r("v-list-tile",{key:t._id,on:{click:function(n){return e.goToSearchResult(t._id)}}},[r("v-list-tile-title",[e._v(e._s(t.title)+" - \n            "),r("span",{staticClass:"font-weight-thin"},[e._v(e._s(e.formatSlice(t.description)))])]),e.isUserFavorite(t._id)?r("v-list-tile-action",[r("v-icon",[e._v("mdi-heart")])],1):e._e()],1)}),1)],1):e._e(),r("v-toolbar-items",{staticClass:"hidden-xs-only"},[e._l(e.horizontalNavItems,function(t){return r("v-btn",{key:t.title,attrs:{flat:"",to:t.link}},[t.hasOwnProperty("icon")?r("v-icon",{staticClass:"hidden-sm-only mr-2",attrs:{left:""}},[e._v(e._s(t.icon))]):e._e(),e._v("\n          "+e._s(t.title)+"\n      ")],1)}),e.user?r("v-btn",{directives:[{name:"push",rawName:"v-push:to",value:"/"+e.user.username,expression:"`/${user.username}`",arg:"to"}],attrs:{flat:""}},[r("v-img",{staticClass:"grey lighten-2 mr-2 wh-24 round",attrs:{src:e.user.avatar,"aspect-ratio":"1"}}),r("v-badge",{class:{bounce:e.badgeAnimated},attrs:{right:"",color:"deep-orange lighten-3"}},[e.user.favorites&&e.user.favorites.length?r("span",{attrs:{slot:"badge"},slot:"badge"},[e._v(e._s(e.user.favorites.length))]):e._e(),e._v("\n            我的\n          ")])],1):e._e()],2),e.user?r("v-toolbar-items",{staticClass:"hidden-xs-only",on:{click:e.signoutUser}},[r("v-btn",{attrs:{flat:""}},[r("v-icon",{staticClass:"hidden-sm-only mr-2",attrs:{left:""}},[e._v("mdi-logout")]),e._v("注销\n      ")],1)],1):e._e()],1),r("v-content",[r("transition",{attrs:{name:"fade"}},[e.$route.meta.keepAlive?r("keep-alive",[r("router-view")],1):r("router-view")],1),r("v-snackbar",{attrs:{color:"success",bottom:"",right:"",timeout:5e3},model:{value:e.authSnackbar,callback:function(t){e.authSnackbar=t},expression:"authSnackbar"}},[r("v-icon",{staticClass:"mr-3"},[e._v("mdi-check-circle")]),r("h3",[e._v("Welcome back !")]),r("v-btn",{attrs:{dark:"",flat:""},on:{click:function(t){e.authSnackbar=!1}}},[r("v-icon",[e._v("mdi-close-circle-outline")])],1)],1),this.authError?r("v-snackbar",{attrs:{color:"info",bottom:"",right:"",timeout:5e3},model:{value:e.authErrorSnackbar,callback:function(t){e.authErrorSnackbar=t},expression:"authErrorSnackbar"}},[r("v-icon",{staticClass:"mr-3"},[e._v("mdi-cancel")]),r("h3",[e._v(e._s(e.authError.message))]),r("v-btn",{attrs:{dark:"",flat:"",to:"/signin"}},[r("v-icon",[e._v("mdi-signin")]),e._v("登录\n        ")],1)],1):e._e()],1)],1)},d=[],f=n("0a0d"),p=n.n(f),g=n("bd86"),m=n("2f62"),h={name:"App",data:function(){return{hiddenTitle:!1,sideNav:!1,authSnackbar:!1,authErrorSnackbar:!1,badgeAnimated:!1,searchTerm:"",globalClicked:"false"}},watch:Object(g["a"])({user:function(e,t){null===t&&(this.authSnackbar=!0)},authError:function(e){null!==e&&(this.authErrorSnackbar=!0)}},"user",function(e){var t=this;e&&(this.badgeAnimated=!0,setTimeout(function(){return t.badgeAnimated=!1},1e3))}),computed:Object(r["a"])({},Object(m["b"])(["searchResults","authError","user"]),{horizontalNavItems:function(){var e=[{icon:"mdi-compass-outline",title:"探索",link:"/explorer"},{icon:"mdi-login",title:"登录",link:"/signin"},{icon:"mdi-account-plus-outline",title:"加入",link:"/signup"}];return console.log("[thisuser]",this.user,p()()),this.user&&(e=[{icon:"mdi-compass-outline",title:"探索",link:"/explorer"},{icon:"mdi-cloud-upload-outline",title:"上传",link:"/upload"}]),e},sideNavItems:function(){var e=[{icon:"mdi-compass-outline",title:"探索",link:"/explorer"},{icon:"mdi-login",title:"登录",link:"/signin"},{icon:"mdi-account-plus-outline",title:"加入",link:"/signup"}];return this.user&&(e=[{icon:"mdi-compass-outline",title:"探索",link:"/explorer"},{icon:"mdi-cloud-upload-outline",title:"上传",link:"/upload"}]),e}}),methods:{test:function(){console.log("hi")},toggleSideNav:function(){this.sideNav=!this.sideNav},signoutUser:function(){this.$store.dispatch("signoutUser")},searchPosts:function(){this.$store.dispatch("searchPosts",{searchTerm:this.searchTerm})},goToSearchResult:function(e){this.searchTerm="",this.$router.push("/posts/".concat(e)),this.$store.commit("clearSearchResults")},formatSlice:function(e){return e.length>30?"".concat(e.slice(0,30),"..."):e},isUserFavorite:function(e){return this.user.favorites&&this.user.favorites.some(function(t){return t._id===e})}}},v=h,b=(n("d518"),n("2877")),P=n("6544"),_=n.n(P),y=n("7496"),k=n("4ca6"),U=n("8336"),S=n("b0af"),$=n("549c"),O=n("ce7e6"),I=n("132d"),w=n("adda"),j=n("a722"),C=n("8860"),x=n("ba95"),T=n("40fe"),E=n("5d23"),q=n("f774"),L=n("2db4"),N=n("9910"),R=n("2677"),z=n("71d9"),B=n("2a7f"),A=n("706c"),V=Object(b["a"])(v,l,d,!1,null,"64d2a3b5",null),D=V.exports;_()(V,{VApp:y["a"],VBadge:k["a"],VBtn:U["a"],VCard:S["a"],VContent:$["a"],VDivider:O["a"],VIcon:I["a"],VImg:w["a"],VLayout:j["a"],VList:C["a"],VListTile:x["a"],VListTileAction:T["a"],VListTileContent:E["a"],VListTileTitle:E["c"],VNavigationDrawer:q["a"],VSnackbar:L["a"],VSpacer:N["a"],VTextField:R["a"],VToolbar:z["a"],VToolbarItems:B["a"],VToolbarSideIcon:A["a"],VToolbarTitle:B["b"]});n("a481");var F=n("75fc"),Q=(n("20d6"),n("7514"),n("96cf"),n("3b8d")),H=n("39ff");u["a"].use(m["a"]);var W,M=new m["a"].Store({state:{posts:[],userPosts:[],searchResults:[],user:null,_user:null,loading:!1,error:null,authError:null},mutations:{setPosts:function(e,t){e.posts=t},setUserPosts:function(e,t){e.user.posts=t},setUserFavorites:function(e,t){e.user.favorites=t},setSearchResults:function(e,t){null!==t&&(e.searchResults=t)},setUser:function(e,t){e.user=t},set_user:function(e,t){console.log(t),e._user=t},add_userPost:function(e,t){e._user&&e._user.username===e.user.username&&(console.log("add_user_post"),e._user.posts.unshift(t))},set_userPosts:function(e,t){u["a"].set(e._user,"posts",t),console.log(e._user.posts)},set_userFavorites:function(e,t){e._user.favorites=t},setLoading:function(e,t){e.loading=t},setError:function(e,t){e.error=t},setAuthError:function(e,t){e.authError=t},clearUser:function(e){return e.user=null},clearSearchResults:function(e){return e.searchResults=[]},clearError:function(e){return e.error=null}},actions:{getCurrentUser:function(){var e=Object(Q["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=t.commit,n("setLoading",!0),Te.query({query:H["d"],fetchPolicy:"network-only"}).then(function(e){var t=e.data;console.log(t),n("setUser",t.getCurrentUser),n("setLoading",!1)}).catch(function(e){n("setLoading",!1)});case 3:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}(),getUser:function(e,t){var n=e.commit;n("setLoading",!0),Te.query({query:H["g"],variables:t}).then(function(e){var t=e.data;n("set_user",t.getUser),n("setLoading",!1),console.log("getUser",t.getUser)}).catch(function(e){console.error(e),n("setLoading",!1)})},getPosts:function(e){var t=e.commit;t("setLoading",!0),Te.query({query:H["f"]}).then(function(e){var n=e.data;console.log("action getPosts",n),t("setPosts",n.getPosts),t("setLoading",!1)}).catch(function(e){t("setLoading",!1),console.error(e)})},getUserPosts:function(e,t){var n=e.commit;Te.query({query:H["h"],variables:t}).then(function(e){var t=e.data;console.log("userPosts",t.getUserPosts),n("setUserPosts",t.getUserPosts)}).catch(function(e){return console.error(e)})},getUserFavorites:function(e,t){var n=e.commit;Te.query({query:H["n"],variables:t}).then(function(e){var t=e.data;console.log("postsByIds",t.postsByIds),n("setUserFavorites",t.postsByIds)}).catch(function(e){return console.error(e)})},searchPosts:function(e,t){var n=e.commit;Te.query({query:H["p"],variables:t}).then(function(e){var t=e.data;console.log("search",t.searchPosts),n("setSearchResults",t.searchPosts)}).catch(function(e){return console.error(e)})},addPost:function(e,t){e.commit;var n=t.payload;t.imageUrl;Te.mutate({mutation:H["a"],variables:n,update:function(e,t){var n=t.data.addPost;if(console.log(e),console.log(e.data.data),e.data.data.ROOT_QUERY&&e.data.data.ROOT_QUERY.hasOwnProperty("getPosts")||e.data.parent&&e.data.parent.data.ROOT_QUERY.hasOwnProperty("getPosts")){var r=e.readQuery({query:H["f"]});if(console.log(r),r.getPosts.find(function(e){return e._id===n._id}))return;console.log("readquery",r),r.getPosts.unshift(n),console.log("data.getPosts.unshift",r),e.writeQuery({query:H["f"],data:r})}},refetchQueries:[{query:H["i"],variables:{pageNum:1,pageSize:6}}]}).then(function(e){var t=e.data;if(Te.cache.data.data.ROOT_QUERY['getUser({"username":"'+t.addPost.createdBy+'"})']){var r=Te.cache.readQuery({query:H["g"],variables:{username:t.addPost.createdBy}});console.log(r,n.userId),r.getUser.posts.unshift(t.addPost),Te.cache.writeQuery({query:H["g"],variables:{username:t.addPost.createdBy},data:r}),console.log("add",Te.cache.readFragment({fragment:H["t"],id:"User:"+n.userId}))}}).catch(function(e){console.error(e)})},updateUserPost:function(e,t){var n=e.state,r=e.commit;Te.mutate({mutation:H["s"],variables:t}).then(function(e){var t=e.data;console.log("user posts",n.userPosts),console.log("updated post",t);var o=n.userPosts.findIndex(function(e){return e._id===t.updateUserPost._id}),s=[].concat(Object(F["a"])(n.userPosts.slice(0,o)),[t.updateUserPost],Object(F["a"])(n.userPosts.slice(o+1)));r("setUserPosts",s)}).catch(function(e){return console.error(e)})},deleteUserPost:function(e,t){var n=e.state,r=e.commit;Te.mutate({mutation:H["c"],variables:t}).then(function(e){var o=e.data,s=n._user;if(n._user.posts){var a=n._user.posts.findIndex(function(e){return e._id===o.deleteUserPost._id});console.log(a,n._user.posts.length),a>-1&&(console.log(2),s.posts=[].concat(Object(F["a"])(n._user.posts.slice(0,a)),Object(F["a"])(n._user.posts.slice(a+1))),s.postsSize--,console.log(s))}if(console.log("3"),n._user.favorites){var i=n._user.favorites.findIndex(function(e){return e._id===o.deleteUserPost._id});if(console.log(i,n._user.favorites.length),i>-1){n._user.favorites.splice(0,i),n._user.favorites.slice(i+1);s.favoritesSize--}}r("set_user",s),console.log("del",Te.cache.readQuery({query:H["g"],variables:{username:t.username}}),Te.cache.readFragment({fragment:H["t"],id:"User:"+t.username}))}).catch(function(e){return console.error(e)})},signinUser:function(e,t){var n=e.commit,r=e.dispatch;n("clearError"),n("setLoading",!0),Te.mutate({mutation:H["q"],variables:t,update:function(e,t){var n=t.data.token;console.log(e,n)}}).then(function(e){var t=e.data;n("setLoading",!1),localStorage.setItem("token",t.signinUser.token),console.log("si",ce.currentRoute),r("getCurrentUser"),ce.replace("/")}).catch(function(e){n("setLoading",!1),n("setError",e),console.error(e)})},signupUser:function(e,t){var n=e.commit,r=e.dispatch;n("clearError"),n("setLoading",!0),Te.mutate({mutation:H["r"],variables:t}).then(function(e){var t=e.data;n("setLoading",!1),localStorage.setItem("token",t.signupUser.token),console.log(ce.currentRoute),r("getCurrentUser"),ce.replace("/")}).catch(function(e){n("setLoading",!1),n("setError",e),console.error(e)})},signoutUser:function(){var e=Object(Q["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,n("clearUser"),console.log(Te.cache),localStorage.setItem("token",""),e.next=6,Te.clearStore();case 6:return e.next=8,Te.cache.reset();case 8:return e.next=10,Te.resetStore();case 10:console.log(Te.cache),ce.push("/");case 12:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},getters:{posts:function(e){return e.posts},userPosts:function(e){return e.userPosts},searchResults:function(e){return e.searchResults},user:function(e){return e.user},_user:function(e){return e._user},profileUser:function(e){return e.profileUser},loading:function(e){return e.loading},error:function(e){return e.error},authError:function(e){return e.authError}}}),Y=n("8c4f"),K=function(e,t){return{path:e,query:{redirect:t.fullPath}}};function J(e,t,n){M.getters.user?n():localStorage.getItem("token")?(console.log("user had token"),M.watch(function(e){return e.user},function(){console.log(M.getters.user),M.getters.user||(console.log("user token expired or invalid"),n(K("/signin",e))),n()})):(console.log("user not login"),n(K("/signin",e)))}function G(e,t,n){M.getters.user?n("/"):localStorage.getItem("token")?(console.log("user had token"),M.watch(function(e){return e.user},function(){if(console.log(M.getters.user,e,t),M.getters.user){var r=e.query.redirect;n(r||"/")}else console.log("user token expired or invalid"),n()})):(console.log("user not login"),n())}function X(e,t,n){M.getters.user?n():localStorage.getItem("token")?(console.log("user had token"),M.dispatch("getCurrentUser"),n()):(console.log("no token"),n())}function Z(e){M.getters.user&&e.params.username!==M.getters.user.username?(console.log("visit isn't current user"),(!M.getters._user||M.getters._user&&e.params.username!==M.getters._user.username)&&(console.log("not visited _user"),M.dispatch("getUser",{username:e.params.username}))):M.commit("set_user",M.getters.user)}function ee(e,t,n){M.getters.user?(console.log("had cur user"),Z(e)):M.watch(function(e){return e.user},function(){Z(e)}),n()}var te=function(){return n.e("home").then(n.bind(null,"57da"))},ne=function(){return Promise.all([n.e("Post~Posts~profile"),n.e("profile")]).then(n.bind(null,"c311"))},re=function(){return n.e("group-signinOrup").then(n.bind(null,"cdb6"))},oe=function(){return n.e("group-signinOrup").then(n.bind(null,"ebff"))},se=function(){return Promise.all([n.e("Post~Posts~profile"),n.e("Post~Upload~userPosts"),n.e("Post")]).then(n.bind(null,"632b"))},ae=function(){return Promise.all([n.e("Post~Upload~userPosts"),n.e("Upload~userPosts"),n.e("userPosts")]).then(n.bind(null,"1de0"))},ie=function(){return Promise.all([n.e("Post~Upload~userPosts"),n.e("Upload~userPosts"),n.e("Upload")]).then(n.bind(null,"9bd5"))},ue=function(){return n.e("NotFound").then(n.bind(null,"be4d"))};u["a"].use(Y["a"]);var ce=new Y["a"]({mode:"history",base:"/",routes:[{path:"/",name:"home",component:te,beforeEnter:X},{path:"/signin",name:"signin",component:re,beforeEnter:G},{path:"/signup",name:"signup",component:oe,beforeEnter:G},{path:"/explorer",name:"Posts",component:function(){return Promise.all([n.e("Post~Posts~profile"),n.e("Posts")]).then(n.bind(null,"4af5"))}},{path:"/posts/:postId",name:"Post",component:se,props:!0},{path:"/upload",name:"upload",component:ie,beforeEnter:J},(W={path:"/:username",props:!0,component:ne,beforeEnter:J,meta:{keepAlive:!0}},Object(g["a"])(W,"beforeEnter",ee),Object(g["a"])(W,"children",[{path:"",name:"userPosts",component:ae,meta:{Tab:""}},{path:"likes",name:"likes",component:ae,meta:{Tab:"likes"}}]),W),{path:"*",component:ue}]}),le=n("74ca"),de=n("2bf2"),fe=n("d634"),pe=n("c0cc"),ge=n("4518"),me=n("e13b"),he=n("5f1f"),ve=n("c2c3"),be=n("cf67"),Pe=n("522d"),_e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-alert",{attrs:{type:"error",value:!0,transition:"slide-x-transition",dismissible:""}},[n("h3",[e._v(e._s(e.message))])])},ye=[],ke={props:["message"]},Ue=ke,Se=n("0798"),$e=Object(b["a"])(Ue,_e,ye,!1,null,null,null),Oe=$e.exports;_()($e,{VAlert:Se["a"]});n("86d7");n.d(t,"defaultClient",function(){return Te}),u["a"].component("form-alert",Oe),u["a"].directive("push",{bind:function(e,t){var n=t.value;e.addEventListener("click",function(){ce.push(n)})}}),u["a"].use(Pe["a"]);var Ie=new de["a"]({cacheRedirects:{Query:{getPost:function(e,t,n){var r=t.postId,o=n.getCacheKey;return o({__typename:"Post",id:r})},getUser:function(e,t,n){var r=t.userId,o=n.getCacheKey;return o({__typename:"User",id:r})}}},addTypename:!0}),we=function(e){localStorage.token||localStorage.setItem("token",""),e.setContext({headers:{authorization:localStorage.getItem("token")}})};new fe["ApolloLink"](function(e){return i.a.resolve(e).then(function(e){return we(e)})});console.log("production","=","http://101.132.144.238/graphql","ws://101.132.144.238/graphql","/");var je=Object(be["createUploadLink"])({uri:"http://101.132.144.238/graphql",credentials:"include"}),Ce=new pe["a"]({uri:"ws://101.132.144.238/graphql",options:{reconnect:!0,connectionParams:{authToken:localStorage.getItem("token")}}}),xe=Object(fe["split"])(function(e){var t=e.query,n=Object(ge["getMainDefinition"])(t),r=n.kind,o=n.operation;return"OperationDefinition"===r&&"subscription"===o},Ce,je),Te=new le["a"]({link:fe["ApolloLink"].from([Object(me["a"])(function(e){var t=e.graphQLErrors,n=e.networkError;if(n&&console.log("[networkError]",n),t){var r=!0,o=!1,a=void 0;try{for(var i,u=s()(t);!(r=(i=u.next()).done);r=!0){var c=i.value;console.dir(c),"AuthenticationError"===c.name&&(M.commit("setAuthError",c),M.dispatch("signoutUser"))}}catch(c){o=!0,a=c}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}}}),Object(ve["a"])(function(e){return localStorage.token||localStorage.setItem("token",""),{headers:{authorization:localStorage.getItem("token")}}}),Object(he["a"])({cache:Ie,resolvers:{Mutation:{addPost_:function(e,t,n){var o=n.cache;console.log("client",o,t);var s={Post:Object(r["a"])({_id:-1,__typename:"Post"},t)};return o.writeData({data:s}),null}}},defaults:{Post:{__typename:"Post",_id:-1,imageUrl:"",naturalWidth:0,naturalHeight:0,tags:[],description:""}}}),xe]),defaultOptions:{watchQuery:{fetchPolicy:"cache-and-network"}},queryDeduplication:!0,connectToDevTools:!0,cache:Ie}),Ee=new Pe["a"]({defaultClient:Te});u["a"].config.productionTip=!1,new u["a"]({apolloProvider:Ee,router:ce,store:M,render:function(e){return e(D)},created:function(){this.$store.getters.user||this.$store.dispatch("getCurrentUser")}}).$mount("#app")},"86cc4":function(e,t,n){e.exports=n.p+"img/parallax-material.4e78050e.jpg"},"86d7":function(e,t,n){},"9e4f":function(e,t,n){},d518:function(e,t,n){"use strict";var r=n("9e4f"),o=n.n(r);o.a}});